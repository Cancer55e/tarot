<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>cancer.55e Stella & Tail</title>

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:sans-serif;
  background:#0a0a1a;
  color:white;
  text-align:center;
  padding:20px;
}

h1,h2,h3,h4{
  margin:10px 0;
}

.card{
  margin-top:15px;
  padding:15px;
  border-radius:12px;
  background:#1a1a2e;
}

input,button{
  padding:12px;
  font-size:16px;
  margin:10px;
  border-radius:6px;
  border:none;
}

input{
  width:220px;
  text-align:center;
}

button{
  background:#5c6cff;
  color:white;
  cursor:pointer;
}

.tail-container{
  display:flex;
  gap:10px;
  margin-top:15px;
}

.tail-box{
  flex:1;
  padding:10px;
  border-radius:10px;
  background:#1a1a2e;
}

.tail-current{
  border:2px solid #5c6cff;
}

.small{
  font-size:12px;
  opacity:0.85;
}
</style>
</head>

<body>

<h1>ğŸŒŒ cancer.55e</h1>
<h2>Stella & Tail Calculator</h2>

<input
  type="text"
  id="birth"
  placeholder="ä¾‹ï¼š19980715"
  inputmode="numeric"
  pattern="[0-9]{8}"
  maxlength="8">

<br>
<button onclick="calculate()">ç¢ºå®š</button>

<div id="result"></div>

<script>
// =====================
// ã‚¹ãƒ†ãƒ©å¯¾å¿œè¡¨
// =====================
const stellaCards = {
  3:"GENERATOR ï½ç¾ã®å¥³ç¥ï½",
  4:"REIGNS ï½å›è‡¨ã™ã‚‹è€…ï½",
  5:"SHAMAN ï½ä¼å°å¸«ï½",
  6:"DEAREST ï½æ„›ã‚’ä¸ãˆã‚‹è€…ï½",
  7:"VALKYRIE ï½é»„é‡‘æˆ¦è»Šï½",
  8:"EUSTITIA ï½è£ãã®å¥³ç¥ï½",
  9:"ASTRONOMER ï½å¤©æ–‡å­¦è€…ï½",
  10:"PHARAOH ï½è¬ã«åŒ…ã¾ã‚ŒãŸå­˜åœ¨ï½",
  11:"HARDY EXPLORER ï½å±ˆå¼·ãªæ¢æ¤œå®¶ï½",
  12:"SAMURAI ï½ä¾é­‚ï½",
  13:"STARS MAKER ï½æ˜Ÿã‚’ç”Ÿã‚€è€…ï½",
  14:"ALL THE RAGE ï½ä¸€ä¸–é¢¨é¡ï½",
  15:"REVOLUTIONIST ï½é©å‘½å®¶ï½",
  16:"TRANSFORMERS ï½é¾ç¥ï½",
  17:"THE HERO ï½å„ªã—ãè‹±é›„ï½",
  18:"CLEVER THINKER ï½æœˆã®å¥³ç¥ï½",
  19:"THE KING OF KINGS ï½ä¸–ç•Œçš‡å¸ï½",
  20:"CELEBRATER ï½å¤©ä½¿ï½",
  21:"THE CREATER ï½å‰µé€ ä¸»ï½"
};

// =====================
// ãƒ†ã‚¤ãƒ«ã‚¤ãƒ¤ãƒ¼å¯¾å¿œè¡¨
// =====================
const tailCards = {
  0:"NEW BASIS ï½ç„¡ã‹ã‚‰ç”Ÿã¾ã‚Œã‚‹ã‚¹ãƒ†ãƒ¼ã‚¸ï½",
  1:"SOW THE SEEDS ï½ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å§‹å‹•ï½",
  2:"ROOTS GROW ï½æ ¹ã‚’å¼µã‚‹ï½",
  3:"A VAST FOREST ï½ç”Ÿç”£æ€§ã¨é›†åˆï½",
  4:"TACTICS ï½å›è‡¨ã¨çµ„ç¹”ï½",
  5:"LEARNING ï½çŸ¥è­˜ã®ç¿’å¾—ï½",
  6:"BUDDY ï½ä»²é–“ï½",
  7:"SWITCH ï½åˆ‡ã‚Šæ›¿ãˆï½",
  8:"JUDGEMENT ï½åˆ¤å®šï½",
  9:"DISTANT STAR ï½é ã„æ˜Ÿï½",
  10:"MOVEMENT AND CHANGE ï½ç§»å‹•ã¨å¤‰åŒ–ï½",
  11:"DIVISION POINT ï½åˆ†å²ç‚¹ï½",
  12:"CONTROL ï½å¾‹ã™ã‚‹ï½",
  13:"SKIP ABOUT ï½æµ„åŒ–ãƒ»ç§»å‹•ãƒ»é–‹èŠ±ï½",
  14:"TRANSFER ï½æ°—ã¥ãã¨æœªæ¥ï½",
  15:"DESIRE ï½æ¬²æœ›ã¨ã‚¨ãƒãƒ«ã‚®ãƒ¼ï½",
  16:"SCRAP AND BUILD ï½ç ´å£Šã¨å†ç”Ÿï½",
  17:"NEW STELLAR ï½æ–°ã—ã„æ˜Ÿï½",
  18:"ILLUSION ï½å¹»æƒ³ï½",
  19:"CORRECT ï½æ­£è§£ï½",
  20:"COMPLETION ï½å®Œçµï½",
  21:"A GALAXY ï½æœªæ¥ãŒå‰µã‚‰ã‚Œã‚‹ï½"
};

// =====================
// ã‚¹ãƒ†ãƒ©ãƒŠãƒ³ãƒãƒ¼è¨ˆç®—ï¼ˆèª•ç”Ÿæ—¥ã®ã¿ï¼‰
// =====================
function calcStella(date){
  let y = date.getFullYear();
  let m = date.getMonth() + 1;
  let d = date.getDate();

  let sum = ("" + y + m + d)
    .split("")
    .reduce((a,b)=>a + Number(b), 0);

  // 22ä»¥ä¸Šãªã‚‰ã€ŒäºŒæ¡ã‚’è¶³ã™ã€ã‚’ç¹°ã‚Šè¿”ã™
  while(sum >= 22){
    sum = sum.toString()
      .split("")
      .reduce((a,b)=>a + Number(b), 0);
  }

  return sum;
}

// =====================
// å¹´é½¢è¨ˆç®—ï¼ˆèª•ç”Ÿæ—¥åˆ°é”åˆ¤å®šè¾¼ã¿ï¼‰
// =====================
function calcAge(birthDate){
  let today = new Date();

  let age = today.getFullYear() - birthDate.getFullYear();
  let birthdayThisYear = new Date(
    today.getFullYear(),
    birthDate.getMonth(),
    birthDate.getDate()
  );

  if(today < birthdayThisYear){
    age--;
  }
  return age;
}

// =====================
// ãƒ†ã‚¤ãƒ«ã‚¤ãƒ¤ãƒ¼è¨ˆç®—
// tail = (å¹´é½¢ + ã‚¹ãƒ†ãƒ©) % 22
// =====================
function calcTailYear(age, stella){
  let raw = age + stella;
  let tail = ((raw % 22) + 22) % 22; // å¿µã®ãŸã‚è² æ•°å¯¾ç­–
  return { tail, raw };
}

// =====================
// å‘¨ç›®è¨ˆç®—ï¼ˆæ–°ãƒ«ãƒ¼ãƒ«ï¼‰
// - 0ã€œ18æ­³ï¼š0å‘¨ç›®ï¼ˆåº‡è­·ï¼‰
// - 19æ­³ä»¥é™ï¼šæœ€åˆã«ã€Œãƒ†ã‚¤ãƒ«0ï¼ˆrawãŒ22ã®å€æ•°ï¼‰ã€ã«æ¥ãŸç¬é–“ã«1å‘¨ç›®ã‚¹ã‚¿ãƒ¼ãƒˆ
// - ä»¥é™ã€ãƒ†ã‚¤ãƒ«0ã‚’è¿ãˆã‚‹ãŸã³ã« +1å‘¨
// =====================
function calcWeek(age, stella){
  if(age <= 18){
    return 0; // å‘¨ç›®0ï¼ˆåº‡è­·ï¼‰
  }

  const raw = age + stella;

  // 19æ­³æ™‚ç‚¹ã®raw
  const startRaw = 19 + stella;

  // 19æ­³ä»¥é™ã§æœ€åˆã«ãƒ†ã‚¤ãƒ«0ã«ãªã‚‹rawï¼ˆ22ã®å€æ•°ï¼‰ã‚’æ±‚ã‚ã‚‹
  const firstMultiple = Math.ceil(startRaw / 22) * 22;

  // ã¾ã æœ€åˆã®ãƒ†ã‚¤ãƒ«0ã«åˆ°é”ã—ã¦ã„ãªã„å ´åˆã¯0å‘¨ç›®
  if(raw < firstMultiple){
    return 0;
  }

  // æœ€åˆã®ãƒ†ã‚¤ãƒ«0ã§1å‘¨ç›®ã€ãã®å¾Œ22é€²ã‚€ã”ã¨ã«+1
  return 1 + Math.floor((raw - firstMultiple) / 22);
}

// =====================
// è¡¨ç¤º
// =====================
function calculate(){
  let birth = document.getElementById("birth").value;

  if(!birth || birth.length !== 8){
    alert("ç”Ÿå¹´æœˆæ—¥ã‚’8æ¡ï¼ˆYYYYMMDDï¼‰ã§å…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }

  let y = Number(birth.slice(0,4));
  let m = Number(birth.slice(4,6)) - 1;
  let d = Number(birth.slice(6,8));

  let date = new Date(y, m, d);

  // æ—¥ä»˜ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
  if(
    date.getFullYear() !== y ||
    date.getMonth() !== m ||
    date.getDate() !== d
  ){
    alert("æ­£ã—ã„æ—¥ä»˜ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
    return;
  }

  let stella = calcStella(date);
  let age = calcAge(date);

  let tailData = calcTailYear(age, stella);
  let week = calcWeek(age, stella);

  let current = tailData.tail;
  let prev = (current + 21) % 22;
  let next = (current + 1) % 22;

  // å‘¨ç›®ã®è£œè¶³è¡¨ç¤ºï¼ˆ0å‘¨ç›®ã ã‘ï¼‰
  let weekNote = (week === 0)
    ? `<p class="small">â€» 19æ­³ä»¥é™ã€æœ€åˆã«ãƒ†ã‚¤ãƒ«ã‚¤ãƒ¤ãƒ¼0ã‚’è¿ãˆãŸç¬é–“ã«1å‘¨ç›®ãŒé–‹å§‹</p>`
    : ``;

  document.getElementById("result").innerHTML = `
    <div class="card">
      <h3>â­ ã‚¹ãƒ†ãƒ©ãƒŠãƒ³ãƒãƒ¼ ${stella}</h3>
      <p>${stellaCards[stella] ?? ""}</p>
    </div>

    <div class="card">
      <p class="small">${age}æ­³ï¼šç¾åœ¨ã®å¹´é½¢</p>
      <p class="small">${week}å‘¨ç›®</p>
      ${weekNote}

      <h3>ğŸŒ™ ãƒ†ã‚¤ãƒ«ã‚¤ãƒ¤ãƒ¼</h3>

      <div class="tail-container">
        <div class="tail-box" style="opacity:0.6;">
          <p>å‰</p>
          <h4>${prev}</h4>
          <p class="small">${tailCards[prev]}</p>
        </div>

        <div class="tail-box tail-current">
          <p>ç¾åœ¨</p>
          <h3>${current}</h3>
          <p class="small">${tailCards[current]}</p>
        </div>

        <div class="tail-box" style="opacity:0.6;">
          <p>æ¬¡</p>
          <h4>${next}</h4>
          <p class="small">${tailCards[next]}</p>
        </div>
      </div>
    </div>
  `;
}
</script>

</body>
</html>
